{"version":3,"file":"main.js","mappings":"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","sources":["webpack:///external commonjs \"@nestjs/common\"","webpack:///external commonjs \"@nestjs/core\"","webpack:///./src/app/app.module.ts","webpack:///external commonjs \"tslib\"","webpack:///./src/app/controllers/auth.controller.ts","webpack:///../../libs/contracts/src/index.ts","webpack:///../../libs/contracts/src/lib/account/account.login.ts","webpack:///external commonjs \"class-validator\"","webpack:///../../libs/contracts/src/lib/account/account.register.ts","webpack:///external commonjs \"nestjs-rmq\"","webpack:///./src/app/dtos/login.dto.ts","webpack:///./src/app/dtos/redister.dto.ts","webpack:///external commonjs \"@nestjs/config\"","webpack:///./src/app/configs/rmq.config.ts","webpack:///external commonjs \"@nestjs/jwt\"","webpack:///./src/app/configs/jwt.config.ts","webpack:///external commonjs \"@nestjs/passport\"","webpack:///./src/app/controllers/user.controller.ts","webpack:///./src/app/guards/jwt.guard.ts","webpack:///./src/app/guards/user.decorator.ts","webpack:///webpack/bootstrap","webpack:///./src/main.ts"],"sourcesContent":["module.exports = require(\"@nestjs/common\");","module.exports = require(\"@nestjs/core\");","import { Module } from '@nestjs/common';\nimport { AuthController } from './controllers/auth.controller';\nimport { ConfigModule } from '@nestjs/config';\nimport { RMQModule } from 'nestjs-rmq';\nimport { getRMQConfig } from './configs/rmq.config';\nimport { JwtModule } from '@nestjs/jwt';\nimport { getJWTConfig } from './configs/jwt.config';\nimport { PassportModule } from '@nestjs/passport';\nimport { UserController } from './controllers/user.controller';\n\n@Module({\n  imports: [\n    ConfigModule.forRoot({envFilePath: 'envs/.api.env', isGlobal: true}),\n    RMQModule.forRootAsync(getRMQConfig()),\n    JwtModule.registerAsync(getJWTConfig()),\n    PassportModule\n  ],\n  controllers: [AuthController, UserController]\n})\nexport class AppModule {}\n","module.exports = require(\"tslib\");","import { Body, Controller, Post, UnauthorizedException } from '@nestjs/common';\nimport {AccountLogin, AccountRegister} from '@purpleschool/contracts';\nimport { RMQService } from 'nestjs-rmq';\nimport { LoginDto } from '../dtos/login.dto';\nimport { RegisterDto } from '../dtos/redister.dto';\n\n@Controller('auth')\nexport class AuthController {\n    constructor(\n        private readonly rmqService: RMQService\n    ) {}\n\n    @Post('register')\n    async register(@Body() dto: RegisterDto) {\n        try {\n            return await this.rmqService.send<AccountRegister.Request, AccountRegister.Response>(AccountRegister.topic, dto);\n        } catch(e) {\n            if (e instanceof Error) {\n                throw new UnauthorizedException(e.message);\n            }\n        }\n    }\n\n    @Post('login')\n    async login(@Body() dto: LoginDto) {\n        try {\n            return await this.rmqService.send<AccountLogin.Request, AccountLogin.Response>(AccountLogin.topic, dto);\n        } catch(e) {\n            if (e instanceof Error) {\n                throw new UnauthorizedException(e.message);\n            }\n        }\n    }\n}\n","export * from './lib/account/account.login';\nexport * from './lib/account/account.register';\n","import { IsEmail, IsString } from 'class-validator';\n\nexport namespace AccountLogin {\n    export const topic = 'account.login.command';\n\n    export class Request {\n        @IsEmail()\n        email: string;\n\n        @IsString()\n        password: string;\n    }\n\n    export class Response {\n        access_token: string;\n    }\n}\n","module.exports = require(\"class-validator\");","import { IsEmail, IsOptional, IsString } from \"class-validator\";\n\nexport namespace AccountRegister {\n    export const topic = 'account.register.command';\n\n    export class Request {\n        @IsEmail()\n        email: string;\n\n        @IsString()\n        password: string;\n\n        @IsOptional()\n        @IsString()\n        displayName?: string;\n    }\n\n    export class Response {\n        email: string;\n    }\n}\n","module.exports = require(\"nestjs-rmq\");","import { IsEmail, IsString } from \"class-validator\";\n\nexport class LoginDto {\n    @IsEmail()\n    email: string;\n\n    @IsString()\n    password: string;\n}\n","import { IsEmail, IsOptional, IsString } from \"class-validator\";\n\nexport class RegisterDto {\n    @IsEmail()\n    email: string;\n\n    @IsString()\n    password: string;\n\n    @IsOptional()\n    @IsString()\n    displayName?: string;\n}","module.exports = require(\"@nestjs/config\");","import { ConfigModule, ConfigService } from \"@nestjs/config\";\nimport { IRMQServiceAsyncOptions } from \"nestjs-rmq\";\n\nexport const getRMQConfig = (): IRMQServiceAsyncOptions => ({\n    inject: [ConfigService],\n    imports: [ConfigModule],\n    useFactory: (configService: ConfigService) => ({\n        exchangeName: configService.get('AMQP_EXCHANGE') ?? '',\n        connections: [\n            {\n                login: configService.get('AMQP_USER') ?? '',\n                password: configService.get('AMQP_PASSWORD') ?? '',\n                host: configService.get('AMQP_HOSTNAME') ?? ''\n            }\n        ],\n        prefetchCount: 32,\n        serviceName: 'purple-account'\n    })\n})","module.exports = require(\"@nestjs/jwt\");","import { ConfigModule, ConfigService } from \"@nestjs/config\";\nimport { JwtModuleAsyncOptions } from \"@nestjs/jwt\";\n\nexport const getJWTConfig = (): JwtModuleAsyncOptions => ({\n    imports: [ConfigModule],\n    inject: [ConfigService],\n    useFactory: (ConfigService: ConfigService) => ({\n        secret: ConfigService.get('JWT_SECRET')\n    })\n})","module.exports = require(\"@nestjs/passport\");","import { Body, Controller, Post, UseGuards } from '@nestjs/common';\nimport {AccountLogin, AccountRegister} from '@purpleschool/contracts';\nimport { JWTAuthGuard } from '../guards/jwt.guard';\nimport { UserId } from '../guards/user.decorator';\n\n@Controller('user')\nexport class UserController {\n    constructor() {}\n\n    @UseGuards(JWTAuthGuard)\n    @Post('info')\n    async info(@UserId() userId: string) {\n    }\n}\n","import { AuthGuard } from \"@nestjs/passport\";\n\nexport class JWTAuthGuard extends AuthGuard('jwt') {}","import { createParamDecorator, ExecutionContext } from \"@nestjs/common\";\n\nexport const UserId = createParamDecorator((data: unknown, ctx: ExecutionContext) => {\n    return ctx.switchToHttp().getRequest()?.user;\n})","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","/**\n * This is not a production server yet!\n * This is only a minimal backend to get started.\n */\n\nimport { Logger } from '@nestjs/common';\nimport { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app/app.module';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  const globalPrefix = 'api';\n  app.setGlobalPrefix(globalPrefix);\n  const port = process.env.PORT || 3000;\n  await app.listen(port);\n  Logger.log(\n    `ðŸš€ API is running on: http://localhost:${port}/${globalPrefix}`\n  );\n}\n\nbootstrap();\n"],"names":[],"sourceRoot":""}